<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Emergency Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            overscroll-behavior: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        .map-container {
            height: 200px;
            background-color: #e2e8f0;
            position: relative;
            overflow: hidden;
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }
        .slide-in {
            animation: slideIn 0.5s ease-out forwards;
        }
        @keyframes slideIn {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .sos-button {
            box-shadow: 0 0 0 rgba(239, 68, 68, 0.4);
            animation: pulse-shadow 2s infinite;
        }
        @keyframes pulse-shadow {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }
        /* Mobile-specific styles */
        .bottom-nav {
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }
        .tab-content {
            height: calc(100vh - 140px);
            overflow-y: auto;
        }
        /* Hide scrollbar for Chrome, Safari and Opera */
        .tab-content::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .tab-content {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        .input-focus:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% {
                transform: translate3d(-1px, 0, 0);
            }
            20%, 80% {
                transform: translate3d(2px, 0, 0);
            }
            30%, 50%, 70% {
                transform: translate3d(-3px, 0, 0);
            }
            40%, 60% {
                transform: translate3d(3px, 0, 0);
            }
        }
        .error-input {
            border-color: #ef4444;
        }
        .error-message {
            color: #ef4444;
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }
        /* Admin access dot styles */
        .admin-dot {
            position: absolute;
            width: 50px;
            height: 50px;
            background-color: transparent;
            border-radius: 50%;
            z-index: 100;
        }
        .admin-dot.active {
            background-color: rgba(59, 130, 246, 0.3);
        }
        /* PIN pad styles */
        .pin-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .pin-digit {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #e5e7eb;
            margin: 0 4px;
        }
        .pin-digit.filled {
            background-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Auth Screens -->
    <div id="auth-container" class="flex flex-col h-screen">
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="flex flex-col h-full justify-center items-center px-6 py-8 fade-in">
            <div class="w-full max-w-md">
                <div class="text-center mb-10">
                    <div class="bg-red-600 text-white h-20 w-20 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-800 mb-2">EmergencyTracker</h1>
                    <p class="text-gray-600">Your personal safety companion</p>
                </div>
                
                <div class="space-y-4">
                    <button id="login-btn" class="w-full bg-red-600 text-white py-3 rounded-lg font-medium hover:bg-red-700 transition shadow-md">
                        Sign In
                    </button>
                    <button id="signup-btn" class="w-full bg-white text-red-600 py-3 rounded-lg font-medium border border-red-600 hover:bg-red-50 transition">
                        Create Account
                    </button>
                </div>
                
                <div class="mt-8 text-center">
                    <p class="text-sm text-gray-500">By continuing, you agree to our <a href="#" class="text-blue-600">Terms of Service</a> and <a href="#" class="text-blue-600">Privacy Policy</a></p>
                </div>
            </div>
        </div>
        
        <!-- Login Screen -->
        <div id="login-screen" class="flex flex-col h-full justify-center px-6 py-8 hidden">
            <div class="w-full max-w-md mx-auto">
                <div class="mb-8">
                    <button id="back-to-welcome" class="flex items-center text-gray-600 mb-6">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Back
                    </button>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Welcome back</h2>
                    <p class="text-gray-600">Sign in to continue to EmergencyTracker</p>
                </div>
                
                <form id="login-form" class="space-y-4">
                    <div>
                        <label for="login-username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                        <input type="text" id="login-username" class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus focus:outline-none transition" placeholder="Enter your username" required>
                        <div id="login-username-error" class="error-message hidden"></div>
                    </div>
                    
                    <div>
                        <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="login-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus focus:outline-none transition" placeholder="Enter your password" required>
                        <div id="login-password-error" class="error-message hidden"></div>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <input type="checkbox" id="remember-me" class="h-4 w-4 text-red-600 rounded">
                            <label for="remember-me" class="ml-2 text-sm text-gray-600">Remember me</label>
                        </div>
                        <a href="#" class="text-sm text-blue-600">Forgot password?</a>
                    </div>
                    
                    <div id="login-error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative hidden" role="alert">
                        <span id="login-error-message" class="block sm:inline"></span>
                    </div>
                    
                    <button type="submit" class="w-full bg-red-600 text-white py-3 rounded-lg font-medium hover:bg-red-700 transition shadow-md">
                        Sign In
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Signup Screen -->
        <div id="signup-screen" class="flex flex-col h-full justify-center px-6 py-8 hidden">
            <div class="w-full max-w-md mx-auto">
                <div class="mb-8">
                    <button id="back-to-welcome-signup" class="flex items-center text-gray-600 mb-6">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Back
                    </button>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Create Account</h2>
                    <p class="text-gray-600">Sign up to start using EmergencyTracker</p>
                </div>
                
                <form id="signup-form" class="space-y-4">
                    <div>
                        <label for="signup-username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                        <input type="text" id="signup-username" class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus focus:outline-none transition" placeholder="Choose a username" required>
                        <div id="signup-username-error" class="error-message hidden"></div>
                    </div>
                    
                    <div>
                        <label for="signup-phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                        <input type="tel" id="signup-phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus focus:outline-none transition" placeholder="Enter your phone number" required>
                        <div id="signup-phone-error" class="error-message hidden"></div>
                    </div>
                    
                    <div>
                        <label for="signup-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="signup-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus focus:outline-none transition" placeholder="Create a password" required>
                        <div id="signup-password-error" class="error-message hidden"></div>
                    </div>
                    
                    <div>
                        <label for="signup-confirm" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                        <input type="password" id="signup-confirm" class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus focus:outline-none transition" placeholder="Confirm your password" required>
                        <div id="signup-confirm-error" class="error-message hidden"></div>
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="terms-agree" class="h-4 w-4 text-red-600 rounded" required>
                        <label for="terms-agree" class="ml-2 text-sm text-gray-600">I agree to the <a href="#" class="text-blue-600">Terms of Service</a> and <a href="#" class="text-blue-600">Privacy Policy</a></label>
                    </div>
                    
                    <div id="signup-error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative hidden" role="alert">
                        <span id="signup-error-message" class="block sm:inline"></span>
                    </div>
                    
                    <button type="submit" class="w-full bg-red-600 text-white py-3 rounded-lg font-medium hover:bg-red-700 transition shadow-md">
                        Create Account
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App Container (Initially Hidden) -->
    <div id="app-container" class="hidden">
        <div class="flex flex-col h-screen">
            <!-- Header -->
            <header class="bg-red-600 text-white shadow-lg fixed top-0 left-0 right-0 z-10">
                <div class="px-4 py-3 flex justify-between items-center">
                    <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                        </svg>
                        <h1 class="text-lg font-bold">EmergencyTracker</h1>
                    </div>
                    <div class="flex items-center">
                        <div id="connection-status" class="flex items-center mr-3">
                            <span class="h-2 w-2 bg-green-400 rounded-full mr-1 pulse"></span>
                            <span class="text-xs">Online</span>
                        </div>
                        <button id="logout-btn" class="text-white p-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                            </svg>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Main Content Area -->
            <main class="flex-grow pt-14 pb-16">
                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Home Tab Content (Default) -->
                    <div id="home-tab" class="px-4 py-3">
                        <!-- SOS Button -->
                        <div class="mb-6 flex justify-center">
                            <button id="emergency-btn" class="sos-button bg-red-600 text-white text-xl font-bold h-24 w-24 rounded-full flex items-center justify-center shadow-lg">
                                SOS
                            </button>
                        </div>
                        
                        <!-- Status Section -->
                        <section class="mb-4 slide-in">
                            <div class="bg-white rounded-xl shadow-md p-4">
                                <div class="flex justify-between items-center mb-3">
                                    <h2 class="text-base font-semibold text-gray-800">Your Status</h2>
                                    <span id="last-updated" class="text-xs text-gray-500">Updated just now</span>
                                </div>
                                
                                <div class="space-y-3">
                                    <div class="bg-gray-50 p-3 rounded-lg">
                                        <div class="flex items-center mb-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-500 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                            </svg>
                                            <h3 class="text-sm font-medium text-gray-700">Location</h3>
                                        </div>
                                        <p id="location-status" class="text-xs text-gray-600">Detecting...</p>
                                    </div>
                                    
                                    <div class="bg-gray-50 p-3 rounded-lg">
                                        <div class="flex items-center mb-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-500 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                            </svg>
                                            <h3 class="text-sm font-medium text-gray-700">Battery</h3>
                                        </div>
                                        <div class="flex items-center">
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div id="battery-level" class="bg-green-500 h-2 rounded-full" style="width: 85%"></div>
                                            </div>
                                            <span id="battery-percentage" class="ml-2 text-xs text-gray-600">85%</span>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gray-50 p-3 rounded-lg">
                                        <div class="flex items-center mb-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-purple-500 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                            <h3 class="text-sm font-medium text-gray-700">Status</h3>
                                        </div>
                                        <select id="status-select" class="w-full text-xs bg-white border border-gray-300 rounded-md py-1 px-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="ok">I'm OK</option>
                                            <option value="help">Need assistance</option>
                                            <option value="medical">Need medical help</option>
                                            <option value="trapped">Trapped/Stranded</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Map Section -->
                        <section class="mb-4 slide-in" style="animation-delay: 0.1s;">
                            <div class="bg-white rounded-xl shadow-md overflow-hidden">
                                <div class="p-4 pb-2">
                                    <h2 class="text-base font-semibold text-gray-800 mb-1">Your Location</h2>
                                </div>
                                <div class="map-container relative">
                                    <div id="map" class="w-full h-full">
                                        <!-- Map will be rendered here -->
                                        <svg class="absolute inset-0 w-full h-full" viewBox="0 0 400 200" xmlns="http://www.w3.org/2000/svg">
                                            <!-- Simple map background -->
                                            <rect x="0" y="0" width="400" height="200" fill="#e2e8f0" />
                                            <path d="M0,50 Q100,80 200,60 T400,70" stroke="#cbd5e1" stroke-width="2" fill="none" />
                                            <path d="M0,100 Q150,70 250,90 T400,60" stroke="#cbd5e1" stroke-width="1.5" fill="none" />
                                            <path d="M0,150 Q100,130 200,150 T400,130" stroke="#cbd5e1" stroke-width="2" fill="none" />
                                            <circle id="user-location" cx="200" cy="100" r="6" fill="#ef4444" class="pulse" />
                                            <circle cx="200" cy="100" r="20" fill="#ef444422" />
                                        </svg>
                                    </div>
                                    <div class="absolute bottom-2 right-2 flex space-x-2">
                                        <button id="refresh-location" class="bg-white p-2 rounded-full shadow-md hover:bg-gray-100">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                            </svg>
                                        </button>
                                        <button id="share-location" class="bg-blue-600 text-white px-2 py-1 rounded-lg text-xs font-medium hover:bg-blue-700 flex items-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                                            </svg>
                                            Share
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>

                    <!-- Contacts Tab Content -->
                    <div id="contacts-tab" class="px-4 py-3 hidden">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-lg font-semibold text-gray-800">Emergency Contacts</h2>
                            <button id="add-contact" class="text-blue-600 text-sm font-medium flex items-center hover:text-blue-800">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                </svg>
                                Add
                            </button>
                        </div>
                        
                        <div id="contacts-list" class="space-y-3">
                            <!-- Contacts will be loaded here dynamically -->
                        </div>
                    </div>

                    <!-- Resources Tab Content -->
                    <div id="resources-tab" class="px-4 py-3 hidden">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">Emergency Resources</h2>
                        
                        <div class="space-y-3">
                            <div class="border border-gray-200 bg-white rounded-lg p-3 hover:bg-gray-50 transition cursor-pointer shadow-sm">
                                <div class="flex items-center">
                                    <div class="bg-red-100 p-2 rounded-lg mr-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="font-medium text-gray-800">Emergency Services</h3>
                                        <p class="text-xs text-gray-500">Call 911 for immediate help</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="border border-gray-200 bg-white rounded-lg p-3 hover:bg-gray-50 transition cursor-pointer shadow-sm">
                                <div class="flex items-center">
                                    <div class="bg-blue-100 p-2 rounded-lg mr-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="font-medium text-gray-800">Evacuation Guidelines</h3>
                                        <p class="text-xs text-gray-500">View safety procedures</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="border border-gray-200 bg-white rounded-lg p-3 hover:bg-gray-50 transition cursor-pointer shadow-sm">
                                <div class="flex items-center">
                                    <div class="bg-green-100 p-2 rounded-lg mr-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="font-medium text-gray-800">Shelter Locations</h3>
                                        <p class="text-xs text-gray-500">Find nearby safe zones</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="border border-gray-200 bg-white rounded-lg p-3 hover:bg-gray-50 transition cursor-pointer shadow-sm">
                                <div class="flex items-center">
                                    <div class="bg-yellow-100 p-2 rounded-lg mr-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="font-medium text-gray-800">First Aid Guide</h3>
                                        <p class="text-xs text-gray-500">Basic emergency procedures</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="border border-gray-200 bg-white rounded-lg p-3 hover:bg-gray-50 transition cursor-pointer shadow-sm">
                                <div class="flex items-center">
                                    <div class="bg-purple-100 p-2 rounded-lg mr-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="font-medium text-gray-800">Emergency Maps</h3>
                                        <p class="text-xs text-gray-500">Evacuation routes & hazard zones</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Tab Content -->
                    <div id="settings-tab" class="px-4 py-3 hidden">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">Settings</h2>
                        
                        <div class="bg-white rounded-xl shadow-md p-4 mb-4">
                            <h3 class="font-medium text-gray-800 mb-3">Profile</h3>
                            
                            <div class="space-y-3">
                                <div class="flex items-center">
                                    <div id="user-avatar" class="bg-blue-100 text-blue-800 font-semibold h-12 w-12 rounded-full flex items-center justify-center mr-3">ME</div>
                                    <div>
                                        <h4 id="user-display-name" class="font-medium text-gray-800">Your Name</h4>
                                        <p id="user-phone" class="text-xs text-gray-500">Phone number</p>
                                    </div>
                                    <button id="edit-profile-btn" class="ml-auto text-blue-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <div class="flex items-center justify-between py-2">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-800">Medical Information</h4>
                                        <p class="text-xs text-gray-500">Add allergies, conditions, etc.</p>
                                    </div>
                                    <button class="text-blue-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-md p-4 mb-4">
                            <h3 class="font-medium text-gray-800 mb-3">App Settings</h3>
                            
                            <div class="space-y-3">
                                <div class="flex items-center justify-between py-2">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-800">Notifications</h4>
                                        <p class="text-xs text-gray-500">Manage alert preferences</p>
                                    </div>
                                    <button class="text-blue-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <div class="flex items-center justify-between py-2">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-800">Location Tracking</h4>
                                        <p class="text-xs text-gray-500">Adjust location settings</p>
                                    </div>
                                    <button class="text-blue-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <div class="flex items-center justify-between py-2">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-800">Privacy</h4>
                                        <p class="text-xs text-gray-500">Manage data sharing</p>
                                    </div>
                                    <button class="text-blue-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-md p-4">
                            <h3 class="font-medium text-gray-800 mb-3">About</h3>
                            
                            <div class="space-y-3">
                                <div class="flex items-center justify-between py-2">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-800">Version</h4>
                                        <p class="text-xs text-gray-500">1.0.0</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between py-2">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-800">Help & Support</h4>
                                        <p class="text-xs text-gray-500">Get assistance</p>
                                    </div>
                                    <button class="text-blue-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <div class="flex items-center justify-between py-2">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-800">Terms & Privacy</h4>
                                        <p class="text-xs text-gray-500">Legal information</p>
                                    </div>
                                    <button class="text-blue-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Bottom Navigation -->
            <nav class="bottom-nav fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex justify-around py-2 z-10">
                <button id="home-btn" class="flex flex-col items-center justify-center w-1/4 text-red-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                    <span class="text-xs mt-1">Home</span>
                </button>
                <button id="contacts-btn" class="flex flex-col items-center justify-center w-1/4 text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <span class="text-xs mt-1">Contacts</span>
                </button>
                <button id="resources-btn" class="flex flex-col items-center justify-center w-1/4 text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                    <span class="text-xs mt-1">Resources</span>
                </button>
                <button id="settings-btn" class="flex flex-col items-center justify-center w-1/4 text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <span class="text-xs mt-1">Settings</span>
                </button>
            </nav>
        </div>
    </div>

    <!-- Add Contact Modal -->
    <div id="contact-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl p-4 w-full max-w-sm mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Add Emergency Contact</h3>
                <button id="close-modal" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="contact-form">
                <div class="mb-4">
                    <label for="contact-name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                    <input type="text" id="contact-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter name" required>
                    <div id="contact-name-error" class="error-message hidden"></div>
                </div>
                <div class="mb-4">
                    <label for="contact-relation" class="block text-sm font-medium text-gray-700 mb-1">Relationship</label>
                    <input type="text" id="contact-relation" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Family, Friend, etc." required>
                    <div id="contact-relation-error" class="error-message hidden"></div>
                </div>
                <div class="mb-6">
                    <label for="contact-phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                    <input type="tel" id="contact-phone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="(555) 123-4567" required>
                    <div id="contact-phone-error" class="error-message hidden"></div>
                </div>
                <div class="flex justify-end">
                    <button type="button" id="cancel-add" class="px-4 py-2 text-gray-700 bg-gray-100 rounded-md mr-2 hover:bg-gray-200">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Save Contact</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="profile-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl p-4 w-full max-w-sm mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Edit Profile</h3>
                <button id="close-profile-modal" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="profile-form">
                <div class="mb-4">
                    <label for="edit-username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                    <input type="text" id="edit-username" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter username" required>
                </div>
                <div class="mb-4">
                    <label for="edit-phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                    <input type="tel" id="edit-phone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter phone number" required>
                </div>
                <div class="mb-6">
                    <label for="edit-password" class="block text-sm font-medium text-gray-700 mb-1">New Password (optional)</label>
                    <input type="password" id="edit-password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Leave blank to keep current password">
                </div>
                <div class="flex justify-end">
                    <button type="button" id="cancel-edit" class="px-4 py-2 text-gray-700 bg-gray-100 rounded-md mr-2 hover:bg-gray-200">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- SOS Alert Modal -->
    <div id="sos-modal" class="fixed inset-0 bg-red-500 bg-opacity-90 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl p-5 w-full max-w-sm mx-4 text-center">
            <div class="mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-red-600 mx-auto mb-4 animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h3 class="text-xl font-bold text-gray-900 mb-2">Emergency Alert</h3>
                <p class="text-gray-600 mb-6">This will send an SOS alert with your current location to all your emergency contacts.</p>
            </div>
            <div class="flex justify-center space-x-4">
                <button id="cancel-sos" class="px-6 py-3 bg-gray-200 text-gray-800 rounded-lg font-medium hover:bg-gray-300">Cancel</button>
                <button id="confirm-sos" class="px-6 py-3 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700">Send SOS</button>
            </div>
        </div>
    </div>

    <!-- Share Location Modal -->
    <div id="share-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl p-4 w-full max-w-sm mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Share Your Location</h3>
                <button id="close-share-modal" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="mb-4">
                <p class="text-gray-600 mb-3">Select contacts to share your location with:</p>
                <div id="share-contacts-list" class="space-y-2">
                    <!-- Contact checkboxes will be loaded here dynamically -->
                </div>
            </div>
            <div class="mb-4">
                <label for="share-message" class="block text-sm font-medium text-gray-700 mb-1">Add a message (optional)</label>
                <textarea id="share-message" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="I'm at this location..."></textarea>
            </div>
            <div class="flex justify-end">
                <button type="button" id="cancel-share" class="px-4 py-2 text-gray-700 bg-gray-100 rounded-md mr-2 hover:bg-gray-200">Cancel</button>
                <button type="button" id="confirm-share" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Share Location</button>
            </div>
        </div>
    </div>

    <!-- Success Notification -->
    <div id="notification" class="fixed bottom-20 left-0 right-0 mx-auto w-4/5 bg-green-600 text-white px-4 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        <span id="notification-message">Success!</span>
    </div>

    <!-- Admin Access Dots (Hidden) -->
    <div id="admin-access-area" class="fixed top-0 left-0 right-0 h-20 z-20">
        <div id="admin-dot-1" class="admin-dot" style="top: 10px; left: 10px;"></div>
        <div id="admin-dot-2" class="admin-dot" style="top: 10px; left: 50%; transform: translateX(-50%);"></div>
        <div id="admin-dot-3" class="admin-dot" style="top: 10px; right: 10px;"></div>
    </div>

    <!-- Admin PIN Modal -->
    <div id="admin-pin-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl p-5 w-full max-w-xs mx-4">
            <div class="text-center mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Admin Access</h3>
                <p class="text-sm text-gray-600">Enter your PIN to continue</p>
            </div>
            
            <div class="flex justify-center mb-6">
                <div class="flex space-x-2">
                    <div class="pin-digit" id="pin-1"></div>
                    <div class="pin-digit" id="pin-2"></div>
                    <div class="pin-digit" id="pin-3"></div>
                    <div class="pin-digit" id="pin-4"></div>
                </div>
            </div>
            
            <div class="pin-pad mb-4">
                <button class="pin-button bg-gray-100 hover:bg-gray-200 rounded-lg h-14 text-xl font-medium text-gray-800">1</button>
                <button class="pin-button bg-gray-100 hover:bg-gray-200 rounded-lg h-14 text-xl font-medium text-gray-800">2</button>
                <button class="pin-button bg-gray-100 hover:bg-gray-200 rounded-lg h-14 text-xl font-medium text-gray-800">3</button>
                <button class="pin-button bg-gray-100 hover:bg-gray-200 rounded-lg h-14 text-xl font-medium text-gray-800">4</button>
                <button class="pin-button bg-gray-100 hover:bg-gray-200 rounded-lg h-14 text-xl font-medium text-gray-800">5</button>
                <button class="pin-button bg-gray-100 hover:bg-gray-200 rounded-lg h-14 text-xl font-medium text-gray-800">6</button>
                <button class="pin-button bg-gray-100 hover:bg-gray-200 rounded-lg h-14 text-xl font-medium text-gray-800">7</button>
                <button class="pin-button bg-gray-100 hover:bg-gray-200 rounded-lg h-14 text-xl font-medium text-gray-800">8</button>
                <button class="pin-button bg-gray-100 hover:bg-gray-200 rounded-lg h-14 text-xl font-medium text-gray-800">9</button>
                <button class="pin-clear bg-gray-100 hover:bg-gray-200 rounded-lg h-14 text-xl font-medium text-gray-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                <button class="pin-button bg-gray-100 hover:bg-gray-200 rounded-lg h-14 text-xl font-medium text-gray-800">0</button>
                <button class="pin-delete bg-gray-100 hover:bg-gray-200 rounded-lg h-14 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M3 12l6.414 6.414a2 2 0 001.414.586H19a2 2 0 002-2V7a2 2 0 00-2-2h-8.172a2 2 0 00-1.414.586L3 12z" />
                    </svg>
                </button>
            </div>
            
            <div class="flex justify-center">
                <button id="cancel-pin" class="px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Database Admin Panel (Hidden) -->
    <div id="admin-panel" class="hidden fixed inset-0 bg-white z-50 overflow-auto p-4">
        <div class="max-w-4xl mx-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-gray-800">Database Admin Panel</h2>
                <button id="close-admin" class="bg-gray-200 p-2 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div class="mb-8">
                <h3 class="text-lg font-semibold mb-2">Users</h3>
                <div class="bg-gray-100 p-4 rounded-lg">
                    <pre id="users-data" class="whitespace-pre-wrap text-sm"></pre>
                </div>
            </div>
            
            <div class="mb-8">
                <h3 class="text-lg font-semibold mb-2">Contacts</h3>
                <div class="bg-gray-100 p-4 rounded-lg">
                    <pre id="contacts-data" class="whitespace-pre-wrap text-sm"></pre>
                </div>
            </div>
            
            <div class="mb-8">
                <h3 class="text-lg font-semibold mb-2">Emergency Events</h3>
                <div class="bg-gray-100 p-4 rounded-lg">
                    <pre id="events-data" class="whitespace-pre-wrap text-sm"></pre>
                </div>
            </div>
            
            <div class="mb-4">
                <h3 class="text-lg font-semibold mb-2">Location History</h3>
                <div class="bg-gray-100 p-4 rounded-lg">
                    <pre id="locations-data" class="whitespace-pre-wrap text-sm"></pre>
                </div>
            </div>
            
            <div class="flex justify-center">
                <button id="reset-db" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">Reset Database</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Database simulation using localStorage
            const DB = {
                // Initialize the database
                init: function() {
                    if (!localStorage.getItem('emergencyDB')) {
                        const initialData = {
                            users: [],
                            contacts: {},
                            events: [],
                            locations: {}
                        };
                        localStorage.setItem('emergencyDB', JSON.stringify(initialData));
                    }
                    return this.getData();
                },
                
                // Get all data
                getData: function() {
                    return JSON.parse(localStorage.getItem('emergencyDB'));
                },
                
                // Save data
                saveData: function(data) {
                    localStorage.setItem('emergencyDB', JSON.stringify(data));
                },
                
                // User operations
                users: {
                    create: function(username, password, phone) {
                        const db = DB.getData();
                        const existingUser = db.users.find(user => user.username === username);
                        
                        if (existingUser) {
                            return { success: false, message: 'Username already exists' };
                        }
                        
                        const newUser = {
                            id: Date.now().toString(),
                            username,
                            password, // In a real app, this would be hashed
                            phone,
                            createdAt: new Date().toISOString()
                        };
                        
                        db.users.push(newUser);
                        db.contacts[newUser.id] = [];
                        db.locations[newUser.id] = [];
                        DB.saveData(db);
                        
                        return { success: true, user: { ...newUser, password: undefined } };
                    },
                    
                    authenticate: function(username, password) {
                        const db = DB.getData();
                        const user = db.users.find(user => user.username === username && user.password === password);
                        
                        if (user) {
                            return { success: true, user: { ...user, password: undefined } };
                        } else {
                            return { success: false, message: 'Invalid username or password' };
                        }
                    },
                    
                    update: function(userId, data) {
                        const db = DB.getData();
                        const userIndex = db.users.findIndex(user => user.id === userId);
                        
                        if (userIndex === -1) {
                            return { success: false, message: 'User not found' };
                        }
                        
                        // Update user data
                        db.users[userIndex] = { ...db.users[userIndex], ...data };
                        DB.saveData(db);
                        
                        return { success: true, user: { ...db.users[userIndex], password: undefined } };
                    }
                },
                
                // Contact operations
                contacts: {
                    getAll: function(userId) {
                        const db = DB.getData();
                        return db.contacts[userId] || [];
                    },
                    
                    add: function(userId, contactData) {
                        const db = DB.getData();
                        
                        if (!db.contacts[userId]) {
                            db.contacts[userId] = [];
                        }
                        
                        const newContact = {
                            id: Date.now().toString(),
                            ...contactData,
                            createdAt: new Date().toISOString()
                        };
                        
                        db.contacts[userId].push(newContact);
                        DB.saveData(db);
                        
                        return { success: true, contact: newContact };
                    },
                    
                    update: function(userId, contactId, data) {
                        const db = DB.getData();
                        
                        if (!db.contacts[userId]) {
                            return { success: false, message: 'User has no contacts' };
                        }
                        
                        const contactIndex = db.contacts[userId].findIndex(contact => contact.id === contactId);
                        
                        if (contactIndex === -1) {
                            return { success: false, message: 'Contact not found' };
                        }
                        
                        db.contacts[userId][contactIndex] = { ...db.contacts[userId][contactIndex], ...data };
                        DB.saveData(db);
                        
                        return { success: true, contact: db.contacts[userId][contactIndex] };
                    },
                    
                    delete: function(userId, contactId) {
                        const db = DB.getData();
                        
                        if (!db.contacts[userId]) {
                            return { success: false, message: 'User has no contacts' };
                        }
                        
                        const contactIndex = db.contacts[userId].findIndex(contact => contact.id === contactId);
                        
                        if (contactIndex === -1) {
                            return { success: false, message: 'Contact not found' };
                        }
                        
                        db.contacts[userId].splice(contactIndex, 1);
                        DB.saveData(db);
                        
                        return { success: true };
                    }
                },
                
                // Event operations
                events: {
                    create: function(userId, eventType, eventData) {
                        const db = DB.getData();
                        
                        const newEvent = {
                            id: Date.now().toString(),
                            userId,
                            type: eventType,
                            data: eventData,
                            timestamp: new Date().toISOString()
                        };
                        
                        db.events.push(newEvent);
                        DB.saveData(db);
                        
                        return { success: true, event: newEvent };
                    },
                    
                    getByUser: function(userId) {
                        const db = DB.getData();
                        return db.events.filter(event => event.userId === userId);
                    }
                },
                
                // Location operations
                locations: {
                    add: function(userId, coordinates) {
                        const db = DB.getData();
                        
                        if (!db.locations[userId]) {
                            db.locations[userId] = [];
                        }
                        
                        const locationEntry = {
                            id: Date.now().toString(),
                            coordinates,
                            timestamp: new Date().toISOString()
                        };
                        
                        db.locations[userId].push(locationEntry);
                        
                        // Keep only the last 50 locations
                        if (db.locations[userId].length > 50) {
                            db.locations[userId] = db.locations[userId].slice(-50);
                        }
                        
                        DB.saveData(db);
                        
                        return { success: true, location: locationEntry };
                    },
                    
                    getLatest: function(userId) {
                        const db = DB.getData();
                        
                        if (!db.locations[userId] || db.locations[userId].length === 0) {
                            return null;
                        }
                        
                        return db.locations[userId][db.locations[userId].length - 1];
                    }
                },
                
                // Reset the database (for testing)
                reset: function() {
                    const initialData = {
                        users: [],
                        contacts: {},
                        events: [],
                        locations: {}
                    };
                    localStorage.setItem('emergencyDB', JSON.stringify(initialData));
                    return initialData;
                }
            };
            
            // Initialize the database
            DB.init();
            
            // Add some sample data if the database is empty
            const dbData = DB.getData();
            if (dbData.users.length === 0) {
                // Add a sample user
                const sampleUser = DB.users.create('demo', 'password123', '555-123-4567');
                
                // Add sample contacts for the user
                if (sampleUser.success) {
                    DB.contacts.add(sampleUser.user.id, {
                        na',
                        relation: 'Family',
                        phone: '555-987-6543'
                    });
                    
                    DB.contacts.add(sampleUser.user.id, {
                        name: 'Jane Smith',
                        relation: 'Friend',
                        phone: '555-456-7890'
                    });
                    
                    // Add sample location
                    DB.locations.add(sampleUser.user.id, {
                        latitude: 37.7749,
                        longitude: -122.4194
                    });
                    
                    // Add sample event
                    DB.events.create(sampleUser.user.id, 'login', {
                        device: 'Mobile Browser',
                        ip: '192.168.1.1'
                    });
                }
            }
            
            // Initialize variables
            let batteryLevel = 85;
            let locationFound = false;
            let currentUser = null;
            
            // Auth screens
            const welcomeScreen = document.getElementById('welcome-screen');
            const loginScreen = document.getElementById('login-screen');
            const signupScreen = document.getElementById('signup-screen');
            const appContainer = document.getElementById('app-container');
            const authContainer = document.getElementById('auth-container');
            
            // Auth navigation
            document.getElementById('login-btn').addEventListener('click', () => {
                welcomeScreen.classList.add('hidden');
                loginScreen.classList.remove('hidden');
            });
            
            document.getElementById('signup-btn').addEventListener('click', () => {
                welcomeScreen.classList.add('hidden');
                signupScreen.classList.remove('hidden');
            });
            
            document.getElementById('back-to-welcome').addEventListener('click', () => {
                loginScreen.classList.add('hidden');
                welcomeScreen.classList.remove('hidden');
            });
            
            document.getElementById('back-to-welcome-signup').addEventListener('click', () => {
                signupScreen.classList.add('hidden');
                welcomeScreen.classList.remove('hidden');
            });
            
            // Form validation functions
            function validateUsername(username) {
                return username.length >= 3;
            }
            
            function validatePassword(password) {
                return password.length >= 6;
            }
            
            function validatePhone(phone) {
                // Simple validation - in a real app, you'd want more robust validation
                return phone.length >= 10;
            }
            
            function showInputError(inputId, errorMessage) {
                const input = document.getElementById(inputId);
                const errorElement = document.getElementById(`${inputId}-error`);
                
                input.classList.add('error-input');
                errorElement.textContent = errorMessage;
                errorElement.classList.remove('hidden');
                
                input.classList.add('shake');
                setTimeout(() => {
                    input.classList.remove('shake');
                }, 500);
            }
            
            function clearInputError(inputId) {
                const input = document.getElementById(inputId);
                const errorElement = document.getElementById(`${inputId}-error`);
                
                input.classList.remove('error-input');
                errorElement.classList.add('hidden');
            }
            
            // Login form submission
            document.getElementById('login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const username = document.getElementById('login-username').value.trim();
                const password = document.getElementById('login-password').value;
                const loginError = document.getElementById('login-error');
                const loginErrorMessage = document.getElementById('login-error-message');
                
                // Clear previous errors
                clearInputError('login-username');
                clearInputError('login-password');
                loginError.classList.add('hidden');
                
                // Validate inputs
                let hasError = false;
                
                if (!validateUsername(username)) {
                    showInputError('login-username', 'Username must be at least 3 characters');
                    hasError = true;
                }
                
                if (!validatePassword(password)) {
                    showInputError('login-password', 'Password must be at least 6 characters');
                    hasError = true;
                }
                
                if (hasError) return;
                
                // Authenticate user
                const authResult = DB.users.authenticate(username, password);
                
                if (authResult.success) {
                    // Store current user
                    currentUser = authResult.user;
                    
                    // Log login event
                    DB.events.create(currentUser.id, 'login', {
                        timestamp: new Date().toISOString(),
                        device: 'Web Browser'
                    });
                    
                    // Update user display in settings
                    updateUserDisplay(currentUser);
                    
                    // Load user contacts
                    loadUserContacts();
                    
                    // Show app container, hide auth container
                    authContainer.classList.add('hidden');
                    appContainer.classList.remove('hidden');
                    
                    // Show welcome notification
                    showNotification(`Welcome back, ${currentUser.username}!`);
                } else {
                    // Show error message
                    loginErrorMessage.textContent = authResult.message;
                    loginError.classList.remove('hidden');
                }
            });
            
            // Signup form submission
            document.getElementById('signup-form').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const username = document.getElementById('signup-username').value.trim();
                const phone = document.getElementById('signup-phone').value.trim();
                const password = document.getElementById('signup-password').value;
                const confirmPassword = document.getElementById('signup-confirm').value;
                const termsAgreed = document.getElementById('terms-agree').checked;
                const signupError = document.getElementById('signup-error');
                const signupErrorMessage = document.getElementById('signup-error-message');
                
                // Clear previous errors
                clearInputError('signup-username');
                clearInputError('signup-phone');
                clearInputError('signup-password');
                clearInputError('signup-confirm');
                signupError.classList.add('hidden');
                
                // Validate inputs
                let hasError = false;
                
                if (!validateUsername(username)) {
                    showInputError('signup-username', 'Username must be at least 3 characters');
                    hasError = true;
                }
                
                if (!validatePhone(phone)) {
                    showInputError('signup-phone', 'Please enter a valid phone number');
                    hasError = true;
                }
                
                if (!validatePassword(password)) {
                    showInputError('signup-password', 'Password must be at least 6 characters');
                    hasError = true;
                }
                
                if (password !== confirmPassword) {
                    showInputError('signup-confirm', 'Passwords do not match');
                    hasError = true;
                }
                
                if (!termsAgreed) {
                    signupErrorMessage.textContent = 'Please agree to the terms and conditions';
                    signupError.classList.remove('hidden');
                    hasError = true;
                }
                
                if (hasError) return;
                
                // Create user
                const createResult = DB.users.create(username, password, phone);
                
                if (createResult.success) {
                    // Store current user
                    currentUser = createResult.user;
                    
                    // Log signup event
                    DB.events.create(currentUser.id, 'signup', {
                        timestamp: new Date().toISOString(),
                        device: 'Web Browser'
                    });
                    
                    // Update user display in settings
                    updateUserDisplay(currentUser);
                    
                    // Show app container, hide auth container
                    authContainer.classList.add('hidden');
                    appContainer.classList.remove('hidden');
                    
                    // Show welcome notification
                    showNotification(`Account created! Welcome, ${currentUser.username}!`);
                } else {
                    // Show error message
                    signupErrorMessage.textContent = createResult.message;
                    signupError.classList.remove('hidden');
                }
            });
            
            // Logout functionality
            document.getElementById('logout-btn').addEventListener('click', () => {
                if (currentUser) {
                    // Log logout event
                    DB.events.create(currentUser.id, 'logout', {
                        timestamp: new Date().toISOString()
                    });
                }
                
                // Show auth container, hide app container
                appContainer.classList.add('hidden');
                authContainer.classList.remove('hidden');
                welcomeScreen.classList.remove('hidden');
                loginScreen.classList.add('hidden');
                signupScreen.classList.add('hidden');
                
                // Clear form fields
                document.getElementById('login-username').value = '';
                document.getElementById('login-password').value = '';
                document.getElementById('signup-username').value = '';
                document.getElementById('signup-phone').value = '';
                document.getElementById('signup-password').value = '';
                document.getElementById('signup-confirm').value = '';
                document.getElementById('terms-agree').checked = false;
                
                // Reset current user
                currentUser = null;
            });
            
            // Update user display in settings
            function updateUserDisplay(user) {
                const userDisplayName = document.getElementById('user-display-name');
                const userPhone = document.getElementById('user-phone');
                const userAvatar = document.getElementById('user-avatar');
                
                userDisplayName.textContent = user.username;
                userPhone.textContent = user.phone;
                
                // Create initials for avatar
                const initials = user.username
                    .split(' ')
                    .map(name => name.charAt(0).toUpperCase())
                    .join('')
                    .substring(0, 2);
                
                userAvatar.textContent = initials;
            }
            
            // Load user contacts
            function loadUserContacts() {
                if (!currentUser) return;
                
                const contactsList = document.getElementById('contacts-list');
                const shareContactsList = document.getElementById('share-contacts-list');
                
                // Clear existing contacts
                contactsList.innerHTML = '';
                shareContactsList.innerHTML = '';
                
                // Get user contacts
                const contacts = DB.contacts.getAll(currentUser.id);
                
                if (contacts.length === 0) {
                    contactsList.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <p>No emergency contacts added yet.</p>
                            <p class="text-sm mt-2">Add contacts to notify in case of emergency.</p>
                        </div>
                    `;
                } else {
                    // Add contacts to the list
                    contacts.forEach(contact => {
                        // Create contact element for contacts tab
                        const contactElement = document.createElement('div');
                        contactElement.className = 'flex items-center justify-between p-3 bg-white rounded-lg shadow-sm';
                        contactElement.innerHTML = `
                            <div class="flex items-center">
                                <div class="bg-blue-100 text-blue-800 font-semibold h-10 w-10 rounded-full flex items-center justify-center mr-3">${getInitials(contact.name)}</div>
                                <div>
                                    <h3 class="font-medium text-gray-800">${contact.name}</h3>
                                    <p class="text-xs text-gray-500">${contact.relation} - ${contact.phone}</p>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button class="text-gray-500 hover:text-blue-600 p-1 call-contact" data-id="${contact.id}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                    </svg>
                                </button>
                                <button class="text-gray-500 hover:text-red-600 p-1 delete-contact" data-id="${contact.id}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </div>
                        `;
                        contactsList.appendChild(contactElement);
                        
                        // Create contact checkbox for share location modal
                        const shareContactElement = document.createElement('div');
                        shareContactElement.className = 'flex items-center';
                        shareContactElement.innerHTML = `
                            <input type="checkbox" id="share-${contact.id}" class="h-4 w-4 text-blue-600 rounded" checked>
                            <label for="share-${contact.id}" class="ml-2 text-gray-700">${contact.name}</label>
                        `;
                        shareContactsList.appendChild(shareContactElement);
                    });
                    
                    // Add event listeners for contact actions
                    document.querySelectorAll('.call-contact').forEach(button => {
                        button.addEventListener('click', function() {
                            const contactId = this.getAttribute('data-id');
                            const contact = contacts.find(c => c.id === contactId);
                            if (contact) {
                                showNotification(`Calling ${contact.name}...`);
                            }
                        });
                    });
                    
                    document.querySelectorAll('.delete-contact').forEach(button => {
                        button.addEventListener('click', function() {
                            const contactId = this.getAttribute('data-id');
                            const contact = contacts.find(c => c.id === contactId);
                            if (contact && confirm(`Are you sure you want to delete ${contact.name} from your contacts?`)) {
                                DB.contacts.delete(currentUser.id, contactId);
                                loadUserContacts();
                                showNotification(`${contact.name} removed from contacts`);
                            }
                        });
                    });
                }
            }
            
            // Helper function to get initials from name
            function getInitials(name) {
                return name
                    .split(' ')
                    .map(part => part.charAt(0).toUpperCase())
                    .join('')
                    .substring(0, 2);
            }
            
            // Tab navigation
            const tabs = {
                home: document.getElementById('home-tab'),
                contacts: document.getElementById('contacts-tab'),
                resources: document.getElementById('resources-tab'),
                settings: document.getElementById('settings-tab')
            };
            
            const navButtons = {
                home: document.getElementById('home-btn'),
                contacts: document.getElementById('contacts-btn'),
                resources: document.getElementById('resources-btn'),
                settings: document.getElementById('settings-btn')
            };
            
            function switchTab(tabName) {
                // Hide all tabs
                Object.values(tabs).forEach(tab => tab.classList.add('hidden'));
                
                // Show selected tab
                tabs[tabName].classList.remove('hidden');
                
                // Reset all nav buttons to inactive
                Object.values(navButtons).forEach(btn => btn.classList.remove('text-red-600'));
                Object.values(navButtons).forEach(btn => btn.classList.add('text-gray-500'));
                
                // Set active nav button
                navButtons[tabName].classList.remove('text-gray-500');
                navButtons[tabName].classList.add('text-red-600');
            }
            
            // Set up tab navigation
            navButtons.home.addEventListener('click', () => switchTab('home'));
            navButtons.contacts.addEventListener('click', () => {
                switchTab('contacts');
                loadUserContacts(); // Refresh contacts when switching to contacts tab
            });
            navButtons.resources.addEventListener('click', () => switchTab('resources'));
            navButtons.settings.addEventListener('click', () => switchTab('settings'));
            
            // Simulate location detection
            setTimeout(() => {
                locationFound = true;
                document.getElementById('location-status').textContent = "37.7749° N, 122.4194° W";
                
                if (currentUser) {
                    // Save location to database
                    DB.locations.add(currentUser.id, {
                        latitude: 37.7749,
                        longitude: -122.4194
                    });
                }
                
                // Randomly move the user location dot on the map
                setInterval(() => {
                    const userDot = document.getElementById('user-location');
                    const newX = 200 + (Math.random() * 10 - 5);
                    const newY = 100 + (Math.random() * 10 - 5);
                    userDot.setAttribute('cx', newX);
                    userDot.setAttribute('cy', newY);
                    
                    if (currentUser) {
                        // Update location in database occasionally
                        if (Math.random() > 0.7) {
                            DB.locations.add(currentUser.id, {
                                latitude: 37.7749 + (Math.random() * 0.01 - 0.005),
                                longitude: -122.4194 + (Math.random() * 0.01 - 0.005)
                            });
                        }
                    }
                }, 3000);
            }, 2000);
            
            // Simulate battery drain
            setInterval(() => {
                if (batteryLevel > 5) {
                    batteryLevel -= 1;
                    const batteryBar = document.getElementById('battery-level');
                    const batteryText = document.getElementById('battery-percentage');
                    
                    batteryBar.style.width = batteryLevel + '%';
                    batteryText.textContent = batteryLevel + '%';
                    
                    if (batteryLevel < 20) {
                        batteryBar.classList.remove('bg-green-500', 'bg-yellow-500');
                        batteryBar.classList.add('bg-red-500');
                    } else if (batteryLevel < 50) {
                        batteryBar.classList.remove('bg-green-500', 'bg-red-500');
                        batteryBar.classList.add('bg-yellow-500');
                    }
                }
            }, 30000);
            
            // Update last updated time
            setInterval(() => {
                const lastUpdated = document.getElementById('last-updated');
                lastUpdated.textContent = 'Updated just now';
                
                setTimeout(() => {
                    lastUpdated.textContent = 'Updated 1 min ago';
                }, 60000);
            }, 120000);
            
            // Modal functionality
            const contactModal = document.getElementById('contact-modal');
            const profileModal = document.getElementById('profile-modal');
            const sosModal = document.getElementById('sos-modal');
            const shareModal = document.getElementById('share-modal');
            const notification = document.getElementById('notification');
            const adminPanel = document.getElementById('admin-panel');
            const adminPinModal = document.getElementById('admin-pin-modal');
            
            // Add contact modal
            document.getElementById('add-contact').addEventListener('click', () => {
                contactModal.classList.remove('hidden');
            });
            
            document.getElementById('close-modal').addEventListener('click', () => {
                contactModal.classList.add('hidden');
            });
            
            document.getElementById('cancel-add').addEventListener('click', () => {
                contactModal.classList.add('hidden');
            });
            
            document.getElementById('contact-form').addEventListener('submit', (e) => {
                e.preventDefault();
                
                if (!currentUser) {
                    showNotification('You must be logged in to add contacts', 'error');
                    return;
                }
                
                const name = document.getElementById('contact-name').value.trim();
                const relation = document.getElementById('contact-relation').value.trim();
                const phone = document.getElementById('contact-phone').value.trim();
                
                // Clear previous errors
                clearInputError('contact-name');
                clearInputError('contact-relation');
                clearInputError('contact-phone');
                
                // Validate inputs
                let hasError = false;
                
                if (name.length < 2) {
                    showInputError('contact-name', 'Name is required');
                    hasError = true;
                }
                
                if (relation.length < 2) {
                    showInputError('contact-relation', 'Relationship is required');
                    hasError = true;
                }
                
                if (!validatePhone(phone)) {
                    showInputError('contact-phone', 'Please enter a valid phone number');
                    hasError = true;
                }
                
                if (hasError) return;
                
                // Add contact to database
                const result = DB.contacts.add(currentUser.id, {
                    name,
                    relation,
                    phone
                });
                
                if (result.success) {
                    // Close modal and clear form
                    contactModal.classList.add('hidden');
                    document.getElementById('contact-name').value = '';
                    document.getElementById('contact-relation').value = '';
                    document.getElementById('contact-phone').value = '';
                    
                    // Reload contacts
                    loadUserContacts();
                    
                    // Show success notification
                    showNotification('Contact added successfully!');
                }
            });
            
            // Edit profile modal
            document.getElementById('edit-profile-btn').addEventListener('click', () => {
                if (!currentUser) return;
                
                // Populate form with current user data
                document.getElementById('edit-username').value = currentUser.username;
                document.getElementById('edit-phone').value = currentUser.phone;
                document.getElementById('edit-password').value = '';
                
                profileModal.classList.remove('hidden');
            });
            
            document.getElementById('close-profile-modal').addEventListener('click', () => {
                profileModal.classList.add('hidden');
            });
            
            document.getElementById('cancel-edit').addEventListener('click', () => {
                profileModal.classList.add('hidden');
            });
            
            document.getElementById('profile-form').addEventListener('submit', (e) => {
                e.preventDefault();
                
                if (!currentUser) {
                    showNotification('You must be logged in to update your profile', 'error');
                    return;
                }
                
                const username = document.getElementById('edit-username').value.trim();
                const phone = document.getElementById('edit-phone').value.trim();
                const password = document.getElementById('edit-password').value;
                
                // Validate inputs
                if (!validateUsername(username)) {
                    showNotification('Username must be at least 3 characters', 'error');
                    return;
                }
                
                if (!validatePhone(phone)) {
                    showNotification('Please enter a valid phone number', 'error');
                    return;
                }
                
                // Prepare update data
                const updateData = {
                    username,
                    phone
                };
                
                // Add password if provided
                if (password && password.length > 0) {
                    if (!validatePassword(password)) {
                        showNotification('Password must be at least 6 characters', 'error');
                        return;
                    }
                    updateData.password = password;
                }
                
                // Update user in database
                const result = DB.users.update(currentUser.id, updateData);
                
                if (result.success) {
                    // Update current user
                    currentUser = result.user;
                    
                    // Update user display
                    updateUserDisplay(currentUser);
                    
                    // Close modal
                    profileModal.classList.add('hidden');
                    
                    // Show success notification
                    showNotification('Profile updated successfully!');
                }
            });
            
            // SOS modal
            document.getElementById('emergency-btn').addEventListener('click', () => {
                sosModal.classList.remove('hidden');
            });
            
            document.getElementById('cancel-sos').addEventListener('click', () => {
                sosModal.classList.add('hidden');
            });
            
            document.getElementById('confirm-sos').addEventListener('click', () => {
                if (!currentUser) {
                    showNotification('You must be logged in to send an SOS alert', 'error');
                    sosModal.classList.add('hidden');
                    return;
                }
                
                // Get current location
                const location = DB.locations.getLatest(currentUser.id);
                
                // Create emergency event
                DB.events.create(currentUser.id, 'sos', {
                    timestamp: new Date().toISOString(),
                    location: location ? location.coordinates : null,
                    status: document.getElementById('status-select').value
                });
                
                sosModal.classList.add('hidden');
                showNotification('SOS alert sent to all contacts!');
            });
            
            // Share location modal
            document.getElementById('share-location').addEventListener('click', () => {
                if (!currentUser) {
                    showNotification('You must be logged in to share your location', 'error');
                    return;
                }
                
                // Make sure contacts are loaded in the share modal
                loadUserContacts();
                
                shareModal.classList.remove('hidden');
            });
            
            document.getElementById('close-share-modal').addEventListener('click', () => {
                shareModal.classList.add('hidden');
            });
            
            document.getElementById('cancel-share').addEventListener('click', () => {
                shareModal.classList.add('hidden');
            });
            
            document.getElementById('confirm-share').addEventListener('click', () => {
                if (!currentUser) {
                    showNotification('You must be logged in to share your location', 'error');
                    shareModal.classList.add('hidden');
                    return;
                }
                
                // Get selected contacts
                const selectedContacts = [];
                document.querySelectorAll('#share-contacts-list input[type="checkbox"]:checked').forEach(checkbox => {
                    const contactId = checkbox.id.replace('share-', '');
                    selectedContacts.push(contactId);
                });
                
                // Get message
                const message = document.getElementById('share-message').value.trim();
                
                // Get current location
                const location = DB.locations.getLatest(currentUser.id);
                
                // Create share event
                DB.events.create(currentUser.id, 'share_location', {
                    timestamp: new Date().toISOString(),
                    location: location ? location.coordinates : null,
                    contacts: selectedContacts,
                    message
                });
                
                shareModal.classList.add('hidden');
                document.getElementById('share-message').value = '';
                showNotification('Location shared successfully!');
            });
            
            // Refresh location
            document.getElementById('refresh-location').addEventListener('click', () => {
                const userDot = document.getElementById('user-location');
                userDot.classList.add('pulse');
                
                setTimeout(() => {
                    const newX = 200 + (Math.random() * 20 - 10);
                    const newY = 100 + (Math.random() * 20 - 10);
                    userDot.setAttribute('cx', newX);
                    userDot.setAttribute('cy', newY);
                    
                    document.getElementById('location-status').textContent = "37.7749° N, 122.4194° W";
                    
                    if (currentUser) {
                        // Update location in database
                        DB.locations.add(currentUser.id, {
                            latitude: 37.7749 + (Math.random() * 0.01 - 0.005),
                            longitude: -122.4194 + (Math.random() * 0.01 - 0.005)
                        });
                    }
                    
                    showNotification('Location updated!');
                }, 1000);
            });
            
            // Status change
            document.getElementById('status-select').addEventListener('change', (e) => {
                if (currentUser) {
                    // Log status change event
                    DB.events.create(currentUser.id, 'status_change', {
                        timestamp: new Date().toISOString(),
                        status: e.target.value,
                        statusText: e.target.options[e.target.selectedIndex].text
                    });
                }
                
                showNotification('Status updated to: ' + e.target.options[e.target.selectedIndex].text);
            });
            
            // Show notification function
            function showNotification(message, type = 'success') {
                const notificationElement = document.getElementById('notification');
                const messageElement = document.getElementById('notification-message');
                
                messageElement.textContent = message;
                
                // Set color based on type
                if (type === 'error') {
                    notificationElement.classList.remove('bg-green-600');
                    notificationElement.classList.add('bg-red-600');
                } else {
                    notificationElement.classList.remove('bg-red-600');
                    notificationElement.classList.add('bg-green-600');
                }
                
                notificationElement.classList.remove('translate-y-20', 'opacity-0');
                
                setTimeout(() => {
                    notificationElement.classList.add('translate-y-20', 'opacity-0');
                }, 3000);
            }
            
            // Simulate connection status changes
            setInterval(() => {
                const connectionStatus = document.getElementById('connection-status');
                const statusDot = connectionStatus.querySelector('span:first-child');
                const statusText = connectionStatus.querySelector('span:last-child');
                
                if (Math.random() > 0.8) {
                    statusDot.classList.remove('bg-green-400');
                    statusDot.classList.add('bg-yellow-400');
                    statusText.textContent = 'Weak';
                    
                    setTimeout(() => {
                        statusDot.classList.remove('bg-yellow-400');
                        statusDot.classList.add('bg-green-400');
                        statusText.textContent = 'Online';
                    }, 5000);
                }
            }, 30000);
            
            // Admin panel functionality
            document.getElementById('close-admin').addEventListener('click', () => {
                adminPanel.classList.add('hidden');
            });
            
            document.getElementById('reset-db').addEventListener('click', () => {
                if (confirm('Are you sure you want to reset the database? This will delete all users, contacts, and events.')) {
                    DB.reset();
                    updateAdminPanel();
                    showNotification('Database reset successfully');
                }
            });
            
            function updateAdminPanel() {
                const dbData = DB.getData();
                
                document.getElementById('users-data').textContent = JSON.stringify(dbData.users, null, 2);
                document.getElementById('contacts-data').textContent = JSON.stringify(dbData.contacts, null, 2);
                document.getElementById('events-data').textContent = JSON.stringify(dbData.events, null, 2);
                document.getElementById('locations-data').textContent = JSON.stringify(dbData.locations, null, 2);
            }
            
            // Add touch feedback for better mobile experience
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.97)';
                });
                button.addEventListener('touchend', function() {
                    this.style.transform = 'scale(1)';
                });
            });
            
            // Secure Admin Access Implementation
            
            // Admin access pattern sequence
            let adminPattern = [];
            const correctPattern = [1, 2, 3, 1]; // The secret pattern: top-left, middle-top, top-right, top-left
            
            // Admin PIN
            const adminPIN = "1234"; // Your secure PIN
            let currentPIN = "";
            
            // Admin access dots touch handlers
            const adminDot1 = document.getElementById('admin-dot-1');
            const adminDot2 = document.getElementById('admin-dot-2');
            const adminDot3 = document.getElementById('admin-dot-3');
            
            adminDot1.addEventListener('click', () => handleDotTouch(1));
            adminDot2.addEventListener('click', () => handleDotTouch(2));
            adminDot3.addEventListener('click', () => handleDotTouch(3));
            
            function handleDotTouch(dotNumber) {
                // Visual feedback (only visible during development)
                const dot = document.getElementById(`admin-dot-${dotNumber}`);
                dot.classList.add('active');
                
                setTimeout(() => {
                    dot.classList.remove('active');
                }, 300);
                
                // Add to pattern
                adminPattern.push(dotNumber);
                
                // Check if pattern is complete
                if (adminPattern.length === correctPattern.length) {
                    // Check if pattern is correct
                    const isCorrect = adminPattern.every((val, index) => val === correctPattern[index]);
                    
                    if (isCorrect) {
                        // Show PIN modal
                        adminPinModal.classList.remove('hidden');
                    }
                    
                    // Reset pattern
                    adminPattern = [];
                }
            }
            
            // PIN pad functionality
            const pinButtons = document.querySelectorAll('.pin-button');
            const pinClear = document.querySelector('.pin-clear');
            const pinDelete = document.querySelector('.pin-delete');
            const pinDigits = [
                document.getElementById('pin-1'),
                document.getElementById('pin-2'),
                document.getElementById('pin-3'),
                document.getElementById('pin-4')
            ];
            
            pinButtons.forEach(button => {
                button.addEventListener('click', () => {
                    if (currentPIN.length < 4) {
                        currentPIN += button.textContent;
                        updatePINDisplay();
                        
                        // Check if PIN is complete
                        if (currentPIN.length === 4) {
                            if (currentPIN === adminPIN) {
                                // PIN correct, show admin panel
                                adminPinModal.classList.add('hidden');
                                updateAdminPanel();
                                adminPanel.classList.remove('hidden');
                            } else {
                                // PIN incorrect, shake the display
                                const pinDisplay = document.querySelector('.flex.space-x-2');
                                pinDisplay.classList.add('shake');
                                setTimeout(() => {
                                    pinDisplay.classList.remove('shake');
                                    currentPIN = "";
                                    updatePINDisplay();
                                }, 500);
                            }
                        }
                    }
                });
            });
            
            pinClear.addEventListener('click', () => {
                currentPIN = "";
                updatePINDisplay();
            });
            
            pinDelete.addEventListener('click', () => {
                currentPIN = currentPIN.slice(0, -1);
                updatePINDisplay();
            });
            
            document.getElementById('cancel-pin').addEventListener('click', () => {
                adminPinModal.classList.add('hidden');
                currentPIN = "";
                updatePINDisplay();
            });
            
            function updatePINDisplay() {
                for (let i = 0; i < 4; i++) {
                    if (i < currentPIN.length) {
                        pinDigits[i].classList.add('filled');
                    } else {
                        pinDigits[i].classList.remove('filled');
                    }
                }
            }
            
            // Alternative admin access method for keyboard users (Ctrl+Shift+A)
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                    adminPinModal.classList.remove('hidden');
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96715fd520b0cd2c',t:'MTc1Mzg0MjAwMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
